# SSL

## preview
SSL(Secure Sockets Layer) 安全套接层 和继任者传输层安全TLS(Transport Layer Security)是为网络通信提供安全及数据完整性的一种安全协议
广泛用于网页(https)，电子邮件等

位于TCP/IP协议于各种应用层协议之间


## details

### 握手协议
用于客户机和服务器之间用SSL连接通信时使用的第一个协议，包括它们之间的一系列消息，用于服务器和客户机相互验证，协商密码和MAC算法以及保密密钥，用来保护数据，在应用程序的数据传世之前使用的
### 记录协议
记录握手成功后 私钥和MAC以及保证消息完整性

### 警报协议
提供一些错误传输时的报警

## 提供的服务
1. 认证用户和服务器，确保数据发送到正确的客户机和服务器
2. 加密数据(主要)
3. 维护数据的完整性，确保数据在传输过程中不被改变(从2衍生)

## 工作流程
1. 客户端的浏览器向服务器传送客户端SSL协议的版本号，加密算法的种类，产生的随机数，以及其他服务器和客户端之间通信所需要的信息
2. 服务器向客户端传送SSL协议的版本号，加密算法的种类，随机数以及其他相关信息，同时服务器还将向客户端传送自己的证书
3. 客户端利用服务器传过来的信息验证服务器的合法性，服务器的合法性包括：证书是否过期，发现服务器证书的CA是否可靠，发行者证书的的公钥是否正确解开服务器证书的发行者的数据签名，服务器证书上的域名是否和服务器的时间域名向匹配
4. 客户端随机产生一个用于后面通信的对称密码，然后用服务器的公钥对其加密，然后将加密后的 主密码传给服务器
5. 如果服务器要求客户的身份认证（在握手过程中为可选），用户可以建立一个随机数然后对其进行数据签名，将这个含有签名的随机数和客户自己的证书以及加密过的“预主密码”一起传给服务器。
6. 如果服务器要求客户的身份认证，服务器必须检验客户证书和签名随机数的合法性，如果验证通过，服务器将自己的私钥解开加密的主密码,然后执行一系列步骤来产生主通信密码
7. 客户端和服务器使用6中的主密码为对称密码，通信结束时通知握手过程结束


## 数字证书
由CA机构颁发的
里面有证书版本，序列号，签名算法，加密算法，公钥，有效期以及使用者的详细信息

## 应用层的Https
过程如图所示：



   